<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>Wasabi - Share Photos</title>

    <!-- Alpine.js -->
    <script src="https://cdn.jsdelivr.net/gh/alpinejs/alpine@v2.8.2/dist/alpine.min.js"></script>
    <!-- Font Awesome -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css" rel="stylesheet">
    <!-- Grand Hotel Font -->
    <link href="https://fonts.googleapis.com/css2?family=Grand+Hotel&display=swap" rel="stylesheet">
    <!-- Custom Style -->
    <link href="/static/style.css" rel="stylesheet">
</head>

<body class="bg-gray-100">
    <!-- Navbar -->
    <nav class="navbar">
        <div class="nav-content">
            <div class="logo">Wasabi</div>
            <div class="act">
                <a href="/origami/view" class="upload-btn"
                    style="background:transparent; color:#262626; border:1px solid #dbdbdb;">Gallery</a>
            </div>
        </div>
    </nav>

    <div class="container" style="max-width: 600px;">
        <div
            style="background: white; border: 1px solid #dbdbdb; border-radius: 3px; padding: 40px; text-align: center;">
            <h2 style="font-weight: 300; margin-bottom: 20px; font-size: 24px; color:#262626;">Upload New Photo</h2>

            <form enctype='multipart/form-data' method="POST" action="/origami/form" x-data="{ 
                files1: null, 
                files2: null, 
                preview: null,
                async updatePreview() {
                     if (this.files1 && this.files1.length > 0 && this.files2 && this.files2.length > 0) {
                         // Both image and filter present: fetch filtered preview
                         let formData = new FormData();
                         formData.append('customFile', this.files1[0]);
                         formData.append('filter', this.files2[0]);
                         
                         // Show loading or keep old preview? Maybe opacity?
                         // For now just wait.
                         try {
                             let res = await fetch('/origami/preview', {
                                 method: 'POST',
                                 body: formData
                             });
                             if (res.ok) {
                                 let blob = await res.blob();
                                 this.preview = URL.createObjectURL(blob);
                             }
                         } catch(e) { console.error(e); }
                     } else if (this.files1 && this.files1.length > 0) {
                         // Only image: show local preview
                         let reader = new FileReader();
                         reader.onload = (e) => { this.preview = e.target.result; };
                         reader.readAsDataURL(this.files1[0]);
                     } else {
                         this.preview = null;
                     }
                }
            }">

                <div style="border: 2px dashed #dbdbdb; min-height: 200px; display: flex; align-items: center; justify-content: center; border-radius: 8px; margin-bottom: 20px; cursor: pointer; position:relative; overflow: hidden;"
                    class="hover:border-gray-400 transition">
                    <input name="customFile" type="file" id="customFile"
                        class="absolute inset-0 w-full h-full opacity-0 cursor-pointer"
                        x-on:change="files1 = Object.values($event.target.files); updatePreview()"
                        style="position:absolute; top:0; left:0; width:100%; height:100%; opacity:0; cursor:pointer; z-index: 10;"
                        required>

                    <div x-show="!preview" style="text-align: center; padding: 40px;">
                        <i class="fas fa-image fa-3x" style="color:#dbdbdb; margin-bottom:10px;"></i>
                        <p style="color:#8e8e8e;">Drag photos here or click to select</p>
                    </div>

                    <div x-show="preview"
                        style="display:none; width:100%; height:100%; position: absolute; top:0; left:0;">
                        <img :src="preview" style="width:100%; height:100%; object-fit: cover;">
                    </div>
                </div>

                <div class="mb-3" style="text-align: left; margin-bottom:15px;">
                    <label
                        style="display:block; font-weight:600; font-size:14px; margin-bottom:5px; color:#262626;">Filter
                        (Optional)</label>
                    <input name="filter" type="file"
                        x-on:change="files2 = Object.values($event.target.files); updatePreview()"
                        style="width:100%; padding:8px; border:1px solid #dbdbdb; background:#fafafa; border-radius:3px;">
                </div>

                <div class="mb-4" style="text-align: left; margin-bottom:20px;">
                    <label
                        style="display:block; font-weight:600; font-size:14px; margin-bottom:5px; color:#262626;">Tags</label>
                    <input type="text" name="tags" placeholder="e.g. summer, beach (comma separated)"
                        style="width: 100%; padding: 10px; border: 1px solid #dbdbdb; background: #fafafa; border-radius: 3px; outline:none;">
                </div>

                <button type="submit" class="upload-btn"
                    style="width: 100%; padding: 10px; font-size: 14px;">Share</button>
            </form>
        </div>
    </div>
</body>

</html>